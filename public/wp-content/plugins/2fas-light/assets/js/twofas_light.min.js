!function(i){const{__:s,sprintf:e}=wp.i18n;var n=5e3,a=i(".js-twofas-reload-qr-button"),o=i(".js-twofas-qr-image"),r=i(".js-twofas-private-key-value"),t=i(".js-twofas-show-private-key"),f=i(".js-twofas-light-notifications"),c=i(".js-twofas-light-totp-secret-input"),l=i(".js-twofas-light-totp-form"),d=i(".js-twofas-totp-submit"),u=i("#twofas-light-totp-token"),w=i("#twofas_light_backup_code"),p=i("#_wpnonce"),h=i(".js-twofas-light-trusted-devices-box"),g=i(".js-twofas-light-trusted-devices-wrapper"),m=i(".js-twofas-modal-remove-trusted-device"),_=i(".js-twofas-remove-trusted-device-confirm"),v=i(".js-twofas-how-to-add-a-new-device"),j=i(".js-twofas-modal-how-to-add-a-new-device"),b=i(".js-twofas-totp-switch"),k=i("#twofas-light-loginform"),y=i("#wp-submit"),C=i(".js-twofas-configuration-subheader"),x=i(".js-twofas-config-wrapper"),S=i(".js-twofas-configured-box"),T=i(".js-twofas-configured-box-content"),D=i(".js-twofas-light-date-content"),J=i(".js-twofas-remove-config"),N=i(".js-twofas-remove-bar-form"),O=i(".js-twofas-config-bar"),Q=i(".js-twofas-modal-private-key"),q=i(".js-twofas-modal-confirmation"),R=i(".js-twofas-modal-cancel"),M=i(".js-twofas-confirmation-confirm"),U=i(".js-twofas-modal-remove-config"),z=i(".js-twofas-remove-config-confirm"),E=i(".js-twofas-rate-plugin-prompt-box"),F=i(".js-twofas-close-rate-prompt"),H=i(".js-twofas-postpone-rate-prompt"),I=i(".js-twofas-step-back-btn"),Y=i(".js-twofas-step-continue-btn"),A=i(".js-twofas-step-card"),B=i(".js-twofas-step-breadcrumb"),G=i(".js-twofas-backup-codes-box"),K=i(".js-twofas-generate-backup-codes"),L=i(".js-twofas-modal-backup-codes"),P=i(".js-twofas-modal-backup-codes-confirm"),V=i(".js-twofas-regenerate-backup-codes-confirm"),W=i(".twofas-download-codes-link"),X=i(".js-twofas-danger-zone-box"),Z=i(".js-twofas-modal-toggle-totp"),$=i(".js-twofas-toggle-totp-confirm"),tt=i(".js-twofas-toggle-totp-cancel"),at=i(".js-twofas-how-backup-codes-works"),ot=i(".js-twofas-modal-backup-log-in"),st=1,et=!1,nt="",it=null,rt=null;function ft(){b.val("totp_enabled"),ct("totp_enabled"),G.addClass("twofas-show"),h.addClass("twofas-show")}function ct(t){T.each(function(){i(this).attr("data-totp-status")===t?i(this).addClass("twofas-show"):i(this).removeClass("twofas-show")})}function lt(t,a){var o,a='<div class="twofas-light-toast js-twofas-light-toast twofas-light-toast-'+t+'"><div class="twofas-light-toast-content"><p>'+a+"</p></div></div>",s=f.append(a);s=s.children().last(),setTimeout(function(){s.addClass("twofas-show")},100),o=setTimeout(function(){s.removeClass("twofas-show"),setTimeout(function(){s.remove()},1e3)},n),s.on("click",function(){i(this).removeClass("twofas-show"),clearTimeout(o),setTimeout(function(){s.remove()},1e3)})}function dt(){var t;t=Math.floor(Date.now()/1e3),D.attr("data-timestamp-to-format",t),_t(),S.hasClass("twofas-show")||S.addClass("twofas-show")}function ut(){i(nt).animate({opacity:0},250,function(){i(this).removeClass("twofas-show").css("opacity",""),et=!1,nt=""})}function wt(t){t.preventDefault(),ut()}function pt(t){var a=u.val(),o=c.val();t.preventDefault(),d.attr("disabled",!0),I.attr("disabled",!0),i.ajax({url:twofas_light.ajax_url,type:"post",data:{page:twofas_light.twofas_light_menu_page,twofas_light_action:"twofas-light-configure-totp",twofas_light_totp_secret:o,twofas_light_totp_token:a,action:"twofas_light_ajax",security:p.val()},dataType:"json"}).done(function(t){mt((t=JSON.parse(JSON.stringify(t))).twofas_light_trusted_devices),u.val(""),lt("success",e(s("Two-factor authentication%shas been configured successfully.","2fas-light"),"<br />")),x.removeClass("twofas-show"),C.addClass("twofas-hidden"),S.addClass("twofas-show"),G.addClass("twofas-show"),h.addClass("twofas-show"),dt(),X.addClass("twofas-show"),O.hasClass("twofas-show")&&O.removeClass("twofas-show"),ft()}).fail(function(t){400===t.status?(u.val(""),lt("error",e(s("Token is invalid :(%sCheck token and try one more time.","2fas-light"),"<br />"))):lt("error",e(s("Something went wrong.%sTry one more time!","2fas-light"),"<br />"))}).always(function(){return d.attr("disabled",!1),I.attr("disabled",!1),!1})}function ht(t){t.preventDefault(),i.ajax({url:twofas_light.ajax_url,type:"post",data:{page:twofas_light.twofas_light_menu_page,twofas_light_action:"twofas-light-generate-backup-codes",action:"twofas_light_ajax",security:p.val()},dataType:"json"}).done(function(t){var t=JSON.parse(JSON.stringify(t)),o=i(".twofas-modal-codes");W.attr("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t.join("\n"))),o.empty(),t.forEach(function(t,a){o.append("<h6>"+t+"</h6>"),i(".twofas-backup-codes-inputs").append('<input type="hidden" name="codes['+a+']" value="'+t+'" />')}),yt(L,".js-twofas-modal-backup-codes"),i(".twofas-backup-codes-box-new").removeClass("twofas-show"),i(".twofas-backup-codes-box-current").addClass("twofas-show"),i(".twofas-backup-codes-box-current-stats").find("h5").html("5 backup codes left")}).error(function(t){t&&t.responseJSON&&t.responseJSON.error&&"Cannot perform this action because second factor is disabled."===t.responseJSON.error?lt("error","Cannot perform this action because <br />second factor is disabled."):lt("error","Couldn't generate backup codes.<br />Try one more time!")})}function gt(t){i.ajax({url:twofas_light.ajax_url,type:"post",data:{page:twofas_light.twofas_light_menu_page,twofas_light_action:t,action:"twofas_light_ajax",security:p.val()},dataType:"json"}).done(function(t){"totp_enabled"===(t=(t=JSON.parse(JSON.stringify(t))).twofas_light_totp_status)&&ft(),"totp_disabled"===t&&(b.val("totp_disabled"),ct("totp_disabled"),G.removeClass("twofas-show"),h.removeClass("twofas-show"))}).error(function(){lt("error",e(s("Something went wrong.%sTry one more time!","2fas-light"),"<br />"))}).always(function(){b.attr("disabled",!1)})}function mt(t){g.html(t),vt()}function _t(){jt(D.filter("[data-timestamp-to-format]"))}function vt(){jt(g.find("table tbody [data-timestamp-to-format]"))}function jt(t){return t.each(function(){var t,a,o,s,e,n=i(this).attr("data-timestamp-to-format");n&&(e=new Date(1e3*n),i(this).text((a=(t=e).getFullYear(),o=bt(t.getMonth()+1),s=bt(t.getDate()),n=bt(t.getHours()),e=bt(t.getMinutes()),t=bt(t.getSeconds()),a+"-"+o+"-"+s+" "+n+":"+e+":"+t)))})}function bt(t){return t<10?"0"+t:t}function kt(){switch((st=3<st?3:st)<1&&(st=1),A.each(function(){i(this).addClass("hidden")}),i('.js-twofas-step-card[data-step="'+st+'"]').removeClass("hidden"),B.each(function(){i(this).removeClass("active")}),i('.js-twofas-step-breadcrumb[data-step="'+st+'"]').addClass("active"),st){case 1:I.addClass("hidden"),Y.removeClass("hidden"),d.addClass("hidden");break;case 2:I.removeClass("hidden"),Y.removeClass("hidden"),d.addClass("hidden");break;case 3:I.removeClass("hidden"),Y.addClass("hidden"),d.removeClass("hidden"),u.trigger("focus")}}function yt(t,a){t.addClass("twofas-show").animate({opacity:1},500,function(){et=!0,nt=a})}t.on("click",function(t){t.preventDefault(),yt(Q,".js-twofas-modal-private-key")}),a.on("click",function(){yt(q,".js-twofas-modal-confirmation")}),d.on("click",pt),l.on("submit",pt),k.on("submit",function(){y.prop("disabled","disabled")}),J.on("click",function(t){t.preventDefault(),yt(U,".js-twofas-modal-remove-config")}),z.on("click",function(t){t.preventDefault(),N.submit()}),R.on("click",wt),M.on("click",function(t){t.preventDefault(),a.prop("disabled","disabled"),ut(),jQuery.ajax({url:twofas_light.ajax_url,type:"post",data:{page:twofas_light.twofas_light_menu_page,twofas_light_action:"twofas-light-reload-qr-code",action:"twofas_light_ajax",security:p.val()},dataType:"json"}).done(function(t){var a=(t=JSON.parse(JSON.stringify(t))).twofas_light_totp_secret,t=t.twofas_light_qr_code;o.attr("src",t),r.html(a),c.attr("value",a)}).error(function(){lt("error",e(s("Couldn't reload QR code.%sTry one more time!","2fas-light")))}).always(function(){a.prop("disabled",!1)})}),F.on("click",function(){E.addClass("closed"),jQuery.ajax({url:twofas_light.ajax_url,type:"post",data:{page:twofas_light.twofas_light_menu_page,twofas_light_action:"twofas-light-hide-notice",action:"twofas_light_ajax",security:p.val()}})}),H.on("click",function(){E.addClass("closed"),jQuery.ajax({url:twofas_light.ajax_url,type:"post",data:{page:twofas_light.twofas_light_menu_page,twofas_light_action:"twofas-light-postpone-notice",action:"twofas_light_ajax",security:p.val()}})}),_.on("click",function(t){t.preventDefault(),ut(),it.attr("disabled",!0),i.ajax({url:twofas_light.ajax_url,type:"post",data:{device_id:rt,page:twofas_light.twofas_light_menu_page,twofas_light_action:"twofas-light-remove-trusted-device",action:"twofas_light_ajax",security:p.val()},dataType:"json"}).done(function(t){mt((t=JSON.parse(JSON.stringify(t))).twofas_light_trusted_devices),lt("success",e(s("Trusted browser%shas been removed","2fas-light"),"<br />"))}).error(function(){lt("error",e(s("Couldn't remove trusted browser.%sTry one more time!","2fas-light"),"<br />"))}).always(function(){it.attr("disabled",!1),it=rt=null})}),v.on("click",function(t){t.preventDefault(),yt(j,".js-twofas-modal-how-to-add-a-new-device")}),w.on("keyup",function(){var t=this.value.replace(/-/g,"").toUpperCase(),a=this.selectionStart,o=t.substr(0,4),s=t.substr(4,4),t=t.substr(8,4);s.length?(t.length?this.value=[o,s,t].join("-"):this.value=[o,s].join("-"),a<=4&&this.setSelectionRange(a,a),5===a&&this.setSelectionRange(a+1,a+1)):this.value=o}),Y.on("click",function(){st++,kt()}),I.on("click",function(){st--,kt()}),K.on("click",ht),V.on("click",function(t){ut(),ht(t)}),$.on("click",function(){b.attr("disabled",!0),gt("twofas-light-totp-disable"),ut()}),tt.on("click",function(t){wt(t),b.attr("disabled",!1)}),at.on("click",function(t){t.preventDefault(),yt(ot,".js-twofas-modal-backup-log-in")}),i(document).on("click",".js-twofas-remove-trusted-device",function(t){t.preventDefault(),it=i(this),rt=i(this).attr("data-device"),yt(m,".js-twofas-modal-remove-trusted-device")}),i(document).on("click",".js-twofas-totp-switch",function(){b.attr("disabled",!0);if("totp_enabled"===b.val())return yt(Z,".js-twofas-modal-toggle-totp"),!1;gt("twofas-light-totp-enable")}),i(document).on("click",".js-twofas-regenerate-backup-codes",function(t){t.preventDefault(),yt(P,".js-twofas-modal-backup-codes-confirm")}),i(document).on("keyup",function(t){27===t.keyCode&&ut()}),i(document).on("mouseup",function(t){et&&function(t){var a;et&&((a=i(nt).find(".twofas-modal").first()).is(t.target)||0!==a.has(t.target).length||ut())}(t)}),_t(),vt()}(jQuery);